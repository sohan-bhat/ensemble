<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ensemble</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body>

  <!-- Header -->
  <header class="site-header">
    <h1 class="logo">Ensemble</h1>
    <p class="tagline">A shared score for the world</p>
    <div class="mode-toggle">
      <button id="mode-beginner" class="mode-btn active">Beginner</button>
      <button id="mode-advanced" class="mode-btn">Advanced</button>
    </div>
  </header>

  <!-- Score metadata -->
  <div class="score-meta">
    <h2 class="piece-title">Untitled No. 1</h2>
    <div class="meta-details">
      <span class="key-sig">D Major</span>
      <span class="meta-dot">&middot;</span>
      <span class="time-sig">4/4</span>
      <span class="meta-dot">&middot;</span>
      <span class="tempo-display">&#9833; = 100</span>
    </div>
    <div class="note-count"><span id="note-count-num">0</span> notes contributed from around the world</div>
  </div>

  <!-- Transport controls -->
  <div class="transport">
    <div class="transport-left">
      <button id="play-btn" class="transport-btn" title="Play / Pause (Space)">
        <svg id="play-icon" width="18" height="18" viewBox="0 0 18 18" fill="currentColor">
          <polygon points="3,1 15,9 3,17"/>
        </svg>
        <svg id="pause-icon" width="18" height="18" viewBox="0 0 18 18" fill="currentColor" style="display:none">
          <rect x="2" y="1" width="5" height="16"/>
          <rect x="11" y="1" width="5" height="16"/>
        </svg>
      </button>
      <button id="stop-btn" class="transport-btn" title="Stop">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="currentColor">
          <rect x="3" y="3" width="12" height="12"/>
        </svg>
      </button>
    </div>
    <div class="transport-center">
      <button id="prev-measure" class="transport-btn-sm" title="Previous measure (&larr;)">&larr;</button>
      <span id="measure-indicator">Measure 1</span>
      <button id="next-measure" class="transport-btn-sm" title="Next measure (&rarr;)">&rarr;</button>
    </div>
    <div class="transport-right">
      <span class="tempo-label">&#9833; = <span id="tempo-value">100</span></span>
    </div>
  </div>

  <!-- Beginner instrument selector (shown only in beginner mode) -->
  <div id="beginner-instrument-bar" class="beginner-instrument-bar" style="display:none">
    <button class="beginner-inst-btn active" data-inst="violin1">Violin I</button>
    <button class="beginner-inst-btn" data-inst="violin2">Violin II</button>
    <button class="beginner-inst-btn" data-inst="viola">Viola</button>
    <button class="beginner-inst-btn" data-inst="cello">Cello</button>
    <button class="beginner-inst-btn" data-inst="contrabass">Bass</button>
  </div>

  <!-- Score container -->
  <div id="score-wrapper">
    <div id="instrument-labels"></div>
    <div id="score"></div>
  </div>

  <!-- Add instrument button -->
  <div class="add-instrument-area">
    <button class="add-instrument-btn" disabled title="Coming soon">+ Add Instrument <span class="coming-soon">Coming soon</span></button>
  </div>

  <!-- Floating editor overlay -->
  <div id="editor-overlay" class="hidden">
    <div id="editor">
      <div class="editor-header">
        <span id="editor-instrument-name">Violin I</span>
        <button id="editor-prev-measure" class="transport-btn-sm" title="Previous measure (&larr;)">&larr;</button>
        <span id="editor-measure-label">Measure 1</span>
        <button id="editor-next-measure" class="transport-btn-sm" title="Next measure (&rarr;)">&rarr;</button>
        <button id="editor-close" title="Close (Esc)">&times;</button>
      </div>
      <div class="editor-toolbar">
        <div class="toolbar-group">
          <span class="toolbar-label">Duration</span>
          <button class="dur-btn" data-duration="whole" title="Whole note (1)"><svg width="16" height="16" viewBox="0 0 16 16"><ellipse cx="8" cy="8" rx="6" ry="4" fill="none" stroke="currentColor" stroke-width="1.5"/></svg></button>
          <button class="dur-btn" data-duration="half" title="Half note (2)"><svg width="16" height="18" viewBox="0 0 16 18"><ellipse cx="7" cy="12" rx="5" ry="3.5" fill="none" stroke="currentColor" stroke-width="1.5" transform="rotate(-15 7 12)"/><line x1="12" y1="12" x2="12" y2="1" stroke="currentColor" stroke-width="1.5"/></svg></button>
          <button class="dur-btn active" data-duration="quarter" title="Quarter note (3)"><svg width="16" height="18" viewBox="0 0 16 18"><ellipse cx="7" cy="12" rx="5" ry="3.5" fill="currentColor" transform="rotate(-15 7 12)"/><line x1="12" y1="12" x2="12" y2="1" stroke="currentColor" stroke-width="1.5"/></svg></button>
          <button class="dur-btn" data-duration="eighth" title="Eighth note (4)"><svg width="16" height="18" viewBox="0 0 16 18"><ellipse cx="7" cy="12" rx="5" ry="3.5" fill="currentColor" transform="rotate(-15 7 12)"/><line x1="12" y1="12" x2="12" y2="1" stroke="currentColor" stroke-width="1.5"/><path d="M12 1 Q15 4 13 7" fill="none" stroke="currentColor" stroke-width="1.5"/></svg></button>
          <button class="dur-btn" data-duration="sixteenth" title="Sixteenth note (5)"><svg width="16" height="18" viewBox="0 0 16 18"><ellipse cx="7" cy="12" rx="5" ry="3.5" fill="currentColor" transform="rotate(-15 7 12)"/><line x1="12" y1="12" x2="12" y2="1" stroke="currentColor" stroke-width="1.5"/><path d="M12 1 Q15 4 13 7" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M12 4 Q15 7 13 10" fill="none" stroke="currentColor" stroke-width="1.5"/></svg></button>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Mode</span>
          <button id="rest-toggle" class="tool-btn" title="Rest mode (R)">Rest</button>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Accidental</span>
          <button class="acc-btn" data-accidental="sharp" title="Sharp">&#9839;</button>
          <button class="acc-btn" data-accidental="flat" title="Flat">&#9837;</button>
          <button class="acc-btn" data-accidental="natural" title="Natural">&#9838;</button>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Dynamic</span>
          <select id="dynamic-select">
            <option value="pp">pp</option>
            <option value="p">p</option>
            <option value="mp">mp</option>
            <option value="mf" selected>mf</option>
            <option value="f">f</option>
            <option value="ff">ff</option>
          </select>
        </div>
        <div class="toolbar-group">
          <button id="undo-btn" class="tool-btn" title="Undo (Ctrl+Z)">Undo</button>
        </div>
      </div>
      <div id="editor-score-wrapper">
        <div id="editor-score"></div>
        <canvas id="ghost-canvas"></canvas>
      </div>
      <div class="editor-hint">Hover to preview note position. Click to place. Keys: 1-5 duration, R rest, Ctrl+Z undo.</div>
    </div>
  </div>

  <!-- Keyboard shortcut hint (advanced mode) -->
  <div class="shortcut-hint" id="shortcut-hint-advanced">
    <span>Space</span> Play &nbsp;
    <span>E</span> Edit &nbsp;
    <span>Esc</span> Close &nbsp;
    <span>1-5</span> Duration &nbsp;
    <span>R</span> Rest
  </div>

  <!-- Beginner mode hint -->
  <div class="shortcut-hint" id="shortcut-hint-beginner" style="display:none">
    Click on a measure to add notes &middot; Drag note edges to resize &middot; <span>Space</span> Play
  </div>

  <!-- Tutorial overlay -->
  <div id="tutorial-overlay" class="tutorial-overlay hidden">
    <div class="tutorial-backdrop"></div>
    <div class="tutorial-card">
      <div class="tutorial-step-counter"></div>
      <h3 class="tutorial-title"></h3>
      <p class="tutorial-text"></p>
      <div class="tutorial-buttons">
        <button id="tutorial-skip" class="tutorial-btn-skip">Skip</button>
        <button id="tutorial-next" class="tutorial-btn-next">Next</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.3/build/cjs/vexflow.js"></script>
  <script type="module" src="/js/api.js"></script>
  <script type="module" src="/js/renderer.js"></script>
  <script type="module" src="/js/editor.js"></script>
  <script type="module" src="/js/playback.js"></script>
  <script type="module" src="/js/beginner-renderer.js"></script>
  <script type="module" src="/js/tutorial.js"></script>
  <script type="module" src="/js/app.js"></script>
</body>
</html>
